課題１（質問）

・サードパーティクッキーとファーストパーティクッキーの違いを説明してください

・サードパーティ Cookie を用いて広告配信ネットワーク（例えば Google AdSense など）がどのようにユーザの訪問履歴を把握しているのか、説明してください

・そもそもサードパーティークッキーはどのように生成されるのでしょうか？画像埋め込みやスクリプト埋め込みなど、様々な手法を説明してください

・サードパーティクッキーの扱いはブラウザによってどのような差があるのでしょうか？（特に safari は他のブラウザと挙動が異なるので、ぜひ調べてみてください！）

・ドメインは同一で、ポートが異なるクッキーはファーストパーティクッキーでしょうか？サードパーティクッキーでしょうか？（hoge.com:8080 と hoge.com:8081 など）

課題２（実装）

ページの読み込みと同時に、ファーストパーティクッキーと、サードパーティクッキーが設定されるような WEB サイトを作成してください
ヒント：設定方法は「画像を取得する際、ヘッダーでクッキーを設定する方法」が最も手軽でしょう
ブラウザ間にはサードパーティクッキーの扱いに関して差分があります。safari では設定できるけど chrome では設定できる...といった状況も多々あるため、特定のブラウザで動作しなければ他のブラウザでも試してみましょう！

仕様

以下の仕様を満たすような web サービスを作成してください
ドメイン（（例）hoge.com）にアクセスすると、何らかのページが表示される
ページ自体の内容はなんでも可
かつ、クッキーが２つ保存される
クッキー１
domain=hoge.com
クッキー２
domain=xxxxxxxxx.com
（別ドメインならなんでも OK）
共通仕様
name="hoge"など、値はなんでも OK
httponly 属性が付与されている
ここは大事なポイントです！JavaScript から生成するのではなく、サーバからのレスポンスでクッキーを生成してください

技術的な仕様

WEB サーバを作る場合は、node.js と express で作成してみてください（以降の課題でも node.js を多用するため、扱いに慣れてもらいたいのです）
ページを作る際の技術には特に指定がありません。何を使って作成いただいても構いません
強いて挙げるなら、express の static file serving を使うと手軽に WEB ページを作成して返せるので、手軽だと思います
https://expressjs.com/starter/static-files.html

ヒント

「この課題のためだけにドメインを 2 つ取得する必要があるのか・・・」と思われた方。ご安心ください、その必要はありません！
ngrok というツールを使えば、https 対応の簡易的なドメインを自分のローカル環境のプロセスに接続できます
https://ngrok.com/

ngrok は「ngrok.io」までが public suffix として登録されているため、xxx.ngrok.io と yyy.ngrok.io は別のドメインと判定されます
なので ngrok ２台を立ち上げる、あるいは片方のサーバを localhost でもう片方のサーバを ngrok で立ち上げれば、異なるドメインのサーバを簡易的に用意できます
ぜひこれを機に ngrok の使い方にも慣れてみてください！

# 【回答】クッキーを理解する。

課題については、Airtable にアクセスして頂き、「サードパーティクッキーを理解する」をご確認願います。 https://airtable.com/tblg8ePOEQRDtIGiY/viwV3pAlEvPOOgmHF?blocks=hide

## 課題 1 の回答

### サードパーティクッキーとファーストパーティクッキーの違い

Cookie はドメインに関連付けられます。このドメインが閲覧しているページのドメインと同じである場合、そのクッキーは、ファーストパーティ Cookie と呼ばれます。ドメインが異なる場合は、サードパーティ Cookie と呼びます。

例えば、ユーザーがあるサイト(www.example.co.jp)に訪れたとします。 このサイトにはログインが必要なメニューがあり、一度ログインすると次回から情報入力の手間を減らすように Cookie-A が付与されます。

またこのサイトにはバナー広告が表示されていて、バナー広告はアドサーバ（www.adserver.co.jp）から配信されています。そのバナー経由で、ユーザーにはCookie-Bが付与されるとします。

この場合にユーザーが実際に訪れているドメインから発行されている Cookie-A（ドメインがwww.example.co.jp）をファーストパーティ Cookie、それ以外のドメインから発行されている Cookie-B（ドメインがwww.adserver.co.jp）をサードパーティ Cookie と呼びます。

- 参考 URL

  https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies

  https://note.dimage.co.jp/blog_001_firstparty-cookie-thirdpirty-cookie.html

### サードパーティ Cookie を用いて広告配信ネットワーク（例えば Google AdSense など）がどのようにユーザの訪問履歴を把握しているのか

サードパーティ Cookie としてユーザーの訪問履歴を把握するための項目を設定します。

Google AdSense の場合、以下の目的でサードパーティ Cookie を設定します。

- 広告の配信と表示
- Google Adsense の広告設定に基づく広告のカスタマイズ
- 同じ広告が特定のユーザーに表示される回数の制限
- ユーザーが表示の停止を選択した広告の非表示
- 広告の効果測定

Google Adsense の場合、以下のサードパーティ Cookie を設定します。

- 「NID」

ログインせずに Google サービスを利用しているユーザーに Google 広告を表示する際に、上記の目的を果たすために使用します。

- 「IDE」と「ANID」

「IDE」と「ANID」は、Google 以外のサイトに Google 広告を表示する際に、上記の目的を果たすために使用します。

- 参考 URL

https://policies.google.com/technologies/cookies?hl=ja

### サードパーティークッキーはどのように生成されるのか

ブラウザで表示中のページ HTML と同じサーバーから送られた/送るのがファーストパーティークッキーです。制限はありません。
それ以外はサードパーティクッキーです。利用に制限がある場合があります。

例えば、以下の場合を想定します。
ブラウザで「www.example.jp」のページを表示しているとします（つまりHTMLはwww.example.jpから取得しています）。
その HTML には以下のとおり画像や JavaScript が使われています。

- 画像
  遷移先「www.example.jp」の画像
  遷移先「www.example2.jp」の画像

- JavaScript
  遷移先「www.example.jp」のJavaScript
  遷移先「www.example2.jp」のJavaScript

### 画像埋め込みの場合

ブラウザで「www.example.jp」を開き、遷移先「www.example2.jp」の画像をクリックした場合、  
生成されるクッキーは同一ドメインではないため、サードパーティクッキーになります。

### スクリプト埋め込みの場合

ブラウザで「www.example.jp」を開き、遷移先「www.example2.jp」のJavaScriptを含むリンクをクリックした場合、  
生成されるクッキーは同一ドメインではないため、サードパーティクッキーになります。

- 参考 URL
  https://support.google.com/adsense/answer/9274516?hl=ja
  https://webtan.impress.co.jp/e/2017/10/03/27016
  https://www.a8.net/campus/affiliate-beginner/program-kind.html

### サードパーティクッキーの扱いはブラウザによってどのような差があるのか
